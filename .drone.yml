---
kind: pipeline
type: docker
name: Default

trigger:
  event: [push, tag]

image_pull_secrets:
- pull_docker_config

steps:
- name: generate-tags
  image: quay.io/natlibfi/drone-gen-tags

- name: install-instantclient
  image: quay.io/tike/drone-install-instantclient:12.2

- name: test
  image: node:12
  commands:
    - export OCI_LIB_DIR=$PWD/instantclient
    - export OCI_INC_DIR=$PWD/instantclient/sdk/include
    - npm install
    - npm test

- name: docker
  image: plugins/docker
  settings:
    repo: quay.io/tike/aleph-record-caretaker
    registry: quay.io
    username:
      from_secret: docker_username
    password:
      from_secret: docker_password
  when:
    branch: [master, test]

---
kind: secret
name: pull_docker_config
data:
---
kind: secret
name: docker_username
data:
---
kind: secret
name: docker_password
data:
---
kind: signature
hmac: 88ac2e7293056338ba3cfb7644182d64c0ed288b1faef959c6922d28c80951ef

...
